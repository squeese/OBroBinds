<Ui xmlns="http://www.blizzard.com/wow/ui/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.blizzard.com/wow/FrameXML/UI.xsd">
  <Frame name="OBroBindsFrameTemplate" movable="true" parent="UIParent" hidden="true" inherits="BackdropTemplate" virtual="true">
    <Size>
      <AbsDimension x="100" y="100" />
    </Size>
    <Anchors>
      <Anchor point="CENTER" />
    </Anchors>
    <KeyValues>
      <KeyValue key="backdropInfo" value="BACKDROP_TOOLTIP_16_16_5555" type="global"/>
      <KeyValue key="backdropColor" value="TOOLTIP_DEFAULT_BACKGROUND_COLOR" type="global"/>
      <KeyValue key="backdropBorderColor" value="TOOLTIP_DEFAULT_COLOR" type="global"/>
    </KeyValues>
    <Scripts>
      <OnLoad>
        BackdropTemplateMixin.OnBackdropLoaded(self)
        function _G.OBroBinds_Toggle()
          self:dispatch("GUI_TOGGLE")
        end
      </OnLoad>
      <OnShow>
        self:dispatch("GUI_SHOW")
      </OnShow>
      <OnHide>
        self:dispatch("GUI_HIDE")
      </OnHide>
      <OnEvent>
        self:dispatch(event, ...)
      </OnEvent>
    </Scripts>
    <Frames>
      <Frame enableMouse="true" inherits="DialogHeaderTemplate">
        <Anchors>
          <Anchor point="TOP" y="24" />
          <Anchor point="RIGHT" x="-24" />
        </Anchors>
        <Scripts>
          <OnLoad>
            self.Text:SetText("OBroBinds")
            self:RegisterForDrag("LeftButton")
          </OnLoad>
          <OnDragStart>
            self:GetParent():StartMoving()
          </OnDragStart>
          <OnDragStop>
            self:GetParent():StopMovingOrSizing()
          </OnDragStop>
        </Scripts>
      </Frame>
      <Button inherits="UIPanelCloseButtonNoScripts">
        <Anchors>
          <Anchor point="TOPRIGHT" x="0" y="20" />
        </Anchors>
        <Scripts>
          <OnClick>
            OBroBinds_Toggle()
          </OnClick>
        </Scripts>
      </Button>
    </Frames>
  </Frame>
  <Button name="OBroBindsStanceButtonTemplate" inherits="ActionButtonTemplate" virtual="true">
    <Scripts>
      <OnLoad>
        self:RegisterForClicks("AnyUp")
      </OnLoad>
      <OnClick>
        local frame = self:GetParent()
        frame.offset = self.offset ~= frame.offset and self.offset or 1
        frame:dispatch("OFFSET_CHANGED")
      </OnClick>
    </Scripts>
  </Button>
  <Button name="OBroBindsOverrideButtonTemplate" inherits="ActionButtonTemplate" virtual="true">
    <Scripts>
      <OnLoad>
        self:RegisterForDrag("LeftButton")
        self:RegisterForClicks("AnyUp")
        self.icon:SetTexCoord(0.1, 0.9, 0.1, 0.9)
        self.AutoCastable:SetTexCoord(0.15, 0.6, 0.6, 0.15)
        self.AutoCastable:ClearAllPoints()
        self.AutoCastable:SetPoint("BOTTOMLEFT", -14, -12)
        self.AutoCastable:SetScale(0.4)
        self.AutoCastable:SetAlpha(0.75)
        --button.LevelLinkLockIcon:Show()
        --button.SpellHighlightTexture:Show()
        --button.NewActionTexture:Show()
      </OnLoad>
      <OnEnter>
        self:GetParent():dispatch("SHOW_TOOLTIP", self)
      </OnEnter>
      <OnLeave>
        GameTooltip:Hide()
      </OnLeave>
      <OnDragStart>
        if InCombatLockdown() then return end
        self:GetParent():dispatch("OVERRIDE_PICKUP", self)
        self:Update()
      </OnDragStart>
      <OnReceiveDrag>
        if InCombatLockdown() then return end
        self:GetParent():dispatch("OVERRIDE_RECEIVE", self)
        self:Update()
      </OnReceiveDrag>
      <OnClick>
        if InCombatLockdown() then return end
        if button == "RightButton" then
          local frame = self:GetParent()
          local binding = frame.modifier..self.key
          if not frame.mainbar[binding] then
            frame:dispatch("SHOW_DROPDOWN", self)
          end
        elseif GetCursorInfo() then
          self:GetParent():dispatch("OVERRIDE_RECEIVE", self)
          self:Update()
        end
      </OnClick>
    </Scripts>
  </Button>
  <Script file="deps/utilities.lua" />
  <Script file="deps/layouts.lua" />
  <Script file="deps/handlers.lua" />
  <Script file="OBroBinds.lua" />

  <!--
  <Frame name="OBroTEST" parent="UIParent" inherits="BackdropTemplate">
    <Size>
      <AbsDimension x="500" y="300" />
    </Size>
    <Anchors>
      <Anchor point="CENTER" />
    </Anchors>
    <KeyValues>
        <KeyValue key="backdropInfo" value="BACKDROP_TOOLTIP_16_16_5555" type="global"/>
        <KeyValue key="backdropColor" value="TOOLTIP_DEFAULT_BACKGROUND_COLOR" type="global"/>
        <KeyValue key="backdropBorderColor" value="TOOLTIP_DEFAULT_COLOR" type="global"/>
    </KeyValues>
    <Frames>
      <ScrollFrame parentKey="scroll" inherits="UIPanelScrollFrameTemplate">
        <Anchors>
          <Anchor point="TOPLEFT" x="8" y="-8" />
          <Anchor point="BOTTOMRIGHT" x="-8" y="8" />
        </Anchors>
        <ScrollChild>
          <EditBox parentKey="edit" multiLine="true" letters="255" autoFocus="false" countInvisibleLetters="true">
            <Size x="500" y="200"/>
            <Anchors>
              <Anchor point="TOPLEFT" />
            </Anchors>
            <Scripts>
              <OnLoad>
                ScrollingEdit_OnCursorChanged(self, 0, 0, 0, 0)
              </OnLoad>
              <OnTextChanged>
                ScrollingEdit_OnTextChanged(self, self:GetParent())
              </OnTextChanged>
              <OnCursorChanged function="ScrollingEdit_OnCursorChanged"/>
              <OnUpdate>
                ScrollingEdit_OnUpdate(self, elapsed, self:GetParent())
              </OnUpdate>
              <OnEscapePressed function="EditBox_ClearFocus"/>
            </Scripts>
            <FontString inherits="GameFontHighlightSmall"/>
          </EditBox>
        </ScrollChild>
        <Scripts>
          <OnLoad>
            self.scrollBarHideable = true
            ScrollFrame_OnLoad(self)
          </OnLoad>
        </Scripts>
      </ScrollFrame>
      <Button>
        <Anchors>
          <Anchor point="TOPLEFT" x="0" y="0" />
          <Anchor point="BOTTOMRIGHT" x="0" y="0" />
        </Anchors>
        <Scripts>
          <OnClick>
            self:GetParent().scroll.edit:SetFocus()
          </OnClick>
        </Scripts>
      </Button>
    </Frames>
  </Frame>
  -->
</Ui>
